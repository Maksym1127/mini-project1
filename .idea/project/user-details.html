<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="user.css">
</head>
<body>
<a href="index.html"> <button>BACK</button> </a>

<script>
    let title = document.createElement('div')
    title.innerText = `USER`
    title.classList.add('title')
    document.body.appendChild(title)

    let userID = new URL(location.href).searchParams.get('id')
    console.log(userID)
    let baseURL = `https://jsonplaceholder.typicode.com/users/` + userID;
    fetch(baseURL)
        .then(value => value.json())
        .then(data => {

            let main = document.createElement('div')
            main.classList.add('main')
            document.body.appendChild(main)
            console.log(data)
            for (const resultKey in data) {
                if (resultKey === "address" || resultKey === "company") {
                    let div = document.createElement('div');
                    div.classList.add('address')
                    div.innerText = `${resultKey}`
                    main.appendChild(div)

                    for (const key in data[resultKey]) {

                        if (key === "geo") {
                            let div = document.createElement('div');
                            div.classList.add('adr-comp')
                            div.innerText = `${key}:`
                            main.appendChild(div)

                            for (const pKey in data[resultKey][key]) {

                                let div = document.createElement('div');
                                div.classList.add('geo')
                                div.innerText = `${pKey}:  ${data[resultKey][key][pKey]}`
                                main.appendChild(div)
                            }
                        } else {
                            let div = document.createElement('div');
                            div.classList.add('adr-comp')
                            div.innerText = `${key} - ${data[resultKey][key]}`
                            main.appendChild(div)
                        }
                    }

                } else {
                    let div = document.createElement('div');
                    div.classList.add('info')
                    div.innerText = `${resultKey} - ${data[resultKey]}`
                    main.appendChild(div)
                }
            }
            let button = document.createElement('button')
            button.innerText = 'post of current user'
            button.classList.add('button')

            let flag = false;
            button.addEventListener('click', function () {
                if (!flag){
                let postsURL = `https://jsonplaceholder.typicode.com/users/${userID}/posts`
                fetch(postsURL)
                    .then(value => value.json())
                    .then(posts => {
                        let div = document.createElement('div');
                        div.classList.add('posts')
                        document.body.appendChild(div)

                        for (const post of posts) {
                            let block = document.createElement('div')
                            block.classList.add('block')
                            div.appendChild(block)
                            block.innerText = `${post.title}`

                            let button = document.createElement('button')
                            button.classList.add('button2')
                            button.innerText = 'Details'

                                button.onclick = function() {
                                window.location.href = `post-details.html?id=${post.id}`;
                            }
                            block.append(button)
                        }
                    })
                    flag = true;
                }
            })
            document.body.appendChild(button)
        })
</script>
</body>
</html>